<?xml version="1.0" encoding="UTF-8"?>
<!--
    web.config file for running a FastAPI application behind IIS using
    HttpPlatformHandler.  This configuration instructs IIS to launch a
    Python interpreter (specified by the processPath attribute) and
    pass requests to Uvicorn.  Uvicorn is started on the port provided by
    the %HTTP_PLATFORM_PORT% environment variable that HttpPlatformHandler sets
    at runtime.  IIS will proxy traffic to that port.

    Update the value of processPath to point at the python.exe for your
    FastAPI project's virtual environment.  If you use a virtual
    environment in ``C:\inetpub\fastapi-app\venv``, the path would look like
    ``C:\inetpub\fastapi-app\venv\Scripts\python.exe``.
-->
<configuration>
    <system.webServer>
        <handlers>
            <!-- Register HttpPlatformHandler for all requests -->
            <add name="httpPlatformHandler" path="*" verb="*" modules="httpPlatformHandler" resourceType="Unspecified" requireAccess="Script" />
        </handlers>
        <httpPlatform stdoutLogEnabled="true" stdoutLogFile=".\python.log" startupTimeLimit="20"
                      processPath="C:\Path\To\Python.exe"
                      arguments="-m uvicorn --port %HTTP_PLATFORM_PORT% main:app">
            <!-- Additional configuration options for HttpPlatformHandler may go here -->
        </httpPlatform>
    </system.webServer>
</configuration>
